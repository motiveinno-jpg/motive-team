<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Whistle AI ‚Äî Korean Product Sourcing Portal</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#060B18;--bg2:#0A1020;--card:#0D1424;--sf:#111B2E;--pri:#00D4FF;--pri-g:linear-gradient(135deg,#00D4FF,#0088FF);--acc:#FFB800;--ok:#00E676;--err:#FF5252;--w:#fff;--w90:rgba(255,255,255,.9);--w60:rgba(255,255,255,.6);--w40:rgba(255,255,255,.4);--w20:rgba(255,255,255,.2);--w08:rgba(255,255,255,.06);--bd:rgba(255,255,255,.08);--r:14px;--shadow:0 4px 24px rgba(0,0,0,.4)}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);font-family:'Sora',-apple-system,sans-serif;color:var(--w);line-height:1.6;min-height:100vh}
a{color:var(--pri);text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:20px}
.header{display:flex;align-items:center;justify-content:space-between;padding:16px 0;border-bottom:1px solid var(--bd);margin-bottom:30px}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:40px;height:40px;border-radius:10px;background:var(--pri-g);display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:900}
.logo-text{font-size:18px;font-weight:800;letter-spacing:-.5px}
.logo-sub{font-size:10px;color:var(--pri);font-family:'JetBrains Mono'}
.btn{padding:8px 16px;border-radius:10px;border:none;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s}
.btn-pri{background:var(--pri-g);color:#000}.btn-pri:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,212,255,.3)}
.btn-ghost{background:transparent;color:var(--w60);border:1px solid var(--bd)}.btn-ghost:hover{border-color:var(--pri);color:var(--pri)}
.btn-block{width:100%}
.card{background:var(--card);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden;margin-bottom:16px}
.card-h{padding:14px 18px;border-bottom:1px solid var(--bd);font-size:14px;font-weight:700}
.card-b{padding:18px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
@media(max-width:768px){.grid-2,.grid-3{grid-template-columns:1fr}}
.form-group{margin-bottom:14px}
.form-label{display:block;font-size:12px;font-weight:600;color:var(--w60);margin-bottom:4px}
.form-input,.form-select,.form-textarea{width:100%;padding:10px 14px;background:var(--sf);border:1px solid var(--bd);border-radius:10px;color:var(--w);font-size:13px;font-family:inherit}
.form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--pri);box-shadow:0 0 0 3px rgba(0,212,255,.1)}
.form-textarea{resize:vertical;min-height:80px}
select option{background:var(--card);color:var(--w90)}
.product-card{padding:16px;border-radius:12px;background:var(--sf);border:1px solid var(--bd);transition:all .2s}
.product-card:hover{border-color:var(--pri);transform:translateY(-2px);box-shadow:var(--shadow)}
.badge{display:inline-block;padding:2px 8px;border-radius:8px;font-size:10px;font-weight:700}
.hero{text-align:center;padding:40px 20px;margin-bottom:30px}
.hero h1{font-size:32px;font-weight:900;margin-bottom:8px;background:var(--pri-g);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{font-size:14px;color:var(--w60);max-width:600px;margin:0 auto}
.toast{position:fixed;bottom:20px;right:20px;padding:10px 16px;border-radius:10px;font-size:13px;font-weight:600;z-index:9999;animation:slideIn .3s}
.toast-ok{background:var(--ok);color:#000}.toast-err{background:var(--err);color:#fff}.toast-warn{background:var(--acc);color:#000}
@keyframes slideIn{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">
      <div class="logo-icon">W</div>
      <div><div class="logo-text">Whistle AI</div><div class="logo-sub">KOREAN PRODUCT SOURCING</div></div>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-ghost" onclick="showSection('products')">Products</button>
      <button class="btn btn-ghost" onclick="showSection('rfq')">Submit RFQ</button>
      <button class="btn btn-pri" onclick="showSection('rfq')">Get Started</button>
    </div>
  </div>

  <div id="app"></div>
</div>

<script>
var sb=window.supabase.createClient('https://lylktgxngrlxmsldxdqj.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5bGt0Z3huZ3JseG1zbGR4ZHFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MTQ2OTAsImV4cCI6MjA4NzM5MDY5MH0.8kgcDCMBT_STf43MVkeUUiq-K6r-Ytp3nUQ6d-nL2D0');

var S={section:'home',products:[],categories:[]};

function toast(msg,type){
  var t=document.createElement('div');t.className='toast toast-'+(type||'ok');t.textContent=msg;
  document.body.appendChild(t);setTimeout(function(){t.remove();},3000);
}

function showSection(s){S.section=s;render();}

function render(){
  var app=document.getElementById('app');
  switch(S.section){
    case'products':app.innerHTML=pgProducts();break;
    case'rfq':app.innerHTML=pgRFQ();break;
    default:app.innerHTML=pgHome();
  }
}

function pgHome(){
  return '<div class="hero"><h1>Source Premium Korean Products</h1><p>Discover verified K-Beauty, health supplements, and consumer goods directly from Korean manufacturers. AI-powered matching for international buyers.</p></div>'+
  '<div class="grid-3" style="margin-bottom:30px">'+
  '<div class="card"><div class="card-b" style="text-align:center"><div style="font-size:32px;margin-bottom:8px">üîç</div><div style="font-weight:700;margin-bottom:4px">Browse Products</div><div style="font-size:12px;color:var(--w40)">Explore verified Korean products with detailed specs and certifications</div><button class="btn btn-ghost btn-block" style="margin-top:12px" onclick="showSection(\'products\')">View Catalog</button></div></div>'+
  '<div class="card"><div class="card-b" style="text-align:center"><div style="font-size:32px;margin-bottom:8px">üìã</div><div style="font-weight:700;margin-bottom:4px">Submit RFQ</div><div style="font-size:12px;color:var(--w40)">Tell us what you need and we\'ll match you with the right manufacturer</div><button class="btn btn-pri btn-block" style="margin-top:12px" onclick="showSection(\'rfq\')">Request Quote</button></div></div>'+
  '<div class="card"><div class="card-b" style="text-align:center"><div style="font-size:32px;margin-bottom:8px">ü§ù</div><div style="font-weight:700;margin-bottom:4px">Verified Sellers</div><div style="font-size:12px;color:var(--w40)">All manufacturers are vetted and supported by our export specialists</div><button class="btn btn-ghost btn-block" style="margin-top:12px" onclick="showSection(\'rfq\')">Contact Us</button></div></div>'+
  '</div>'+
  '<div class="card"><div class="card-h">Featured Categories</div><div class="card-b"><div class="grid-3">'+
  [{i:'üíÑ',n:'K-Beauty Skincare',d:'Serums, creams, masks, cleansers'},{i:'üíã',n:'Color Cosmetics',d:'Lip, eye, face makeup'},{i:'üíá',n:'Hair Care',d:'Shampoo, treatment, styling'},{i:'üß¥',n:'Body Care',d:'Lotions, soap, bath products'},{i:'üíä',n:'Health Supplements',d:'Vitamins, probiotics, functional foods'},{i:'ü´ß',n:'Home & Living',d:'Diffusers, aromatherapy, cleaning'}].map(function(c){
    return '<div style="padding:14px;border-radius:10px;background:var(--w08);cursor:pointer" onclick="showSection(\'products\')"><div style="font-size:24px;margin-bottom:4px">'+c.i+'</div><div style="font-weight:700;font-size:13px">'+c.n+'</div><div style="font-size:11px;color:var(--w40)">'+c.d+'</div></div>';
  }).join('')+
  '</div></div></div>'+
  '<div style="text-align:center;padding:30px;color:var(--w20);font-size:12px">Whistle AI by MOTIVE Innovation | Connecting Korean Manufacturers to the World</div>';
}

function pgProducts(){
  var h='<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:8px"><h2 style="font-size:20px;font-weight:800">Product Catalog</h2><button class="btn btn-pri" onclick="showSection(\'rfq\')">Request Quote</button></div>';

  if(!S.products.length){
    h+='<div style="text-align:center;padding:40px;color:var(--w40)"><div style="font-size:32px;margin-bottom:8px">üì¶</div>Loading products...</div>';
    loadProducts();
    return h;
  }

  h+='<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px">';
  S.products.forEach(function(p){
    var img=p.images&&p.images[0]?'<img src="'+p.images[0]+'" style="width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:10px">':'<div style="width:100%;height:140px;border-radius:8px;background:var(--w08);display:flex;align-items:center;justify-content:center;font-size:32px;margin-bottom:10px">üì¶</div>';
    h+='<div class="product-card">'+img+
    '<div style="font-weight:700;font-size:14px;margin-bottom:4px">'+(p.name_en||p.name_ko)+'</div>'+
    '<div style="font-size:11px;color:var(--w40);margin-bottom:8px">'+(p.category||'')+(p.hs_code?' | HS '+p.hs_code:'')+'</div>'+
    (p.description_en?'<div style="font-size:12px;color:var(--w60);margin-bottom:8px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">'+p.description_en+'</div>':'')+
    '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">'+
    '<div>'+(p.fob_price?'<span style="font-weight:800;color:var(--acc)">$'+p.fob_price+'</span><span style="font-size:10px;color:var(--w40)"> FOB/unit</span>':'<span style="font-size:12px;color:var(--w40)">Price on request</span>')+'</div>'+
    (p.moq?'<span style="font-size:10px;color:var(--w40)">MOQ: '+p.moq+'</span>':'')+'</div>'+
    '<div style="display:flex;gap:4px;flex-wrap:wrap;margin-bottom:8px">'+
    (p.origin_country?'<span class="badge" style="background:rgba(0,212,255,.1);color:var(--pri)">Made in '+p.origin_country+'</span>':'')+
    (p.certifications&&p.certifications.length?p.certifications.slice(0,3).map(function(c){return '<span class="badge" style="background:rgba(0,230,118,.1);color:var(--ok)">'+(c.name||c)+'</span>';}).join(''):'')+
    '</div>'+
    '<button class="btn btn-pri btn-block" style="font-size:12px" onclick="inquireProduct(\''+p.id+'\')">Inquire Now</button>'+
    '</div>';
  });
  h+='</div>';
  return h;
}

function pgRFQ(){
  return '<div style="max-width:600px;margin:0 auto"><h2 style="font-size:20px;font-weight:800;margin-bottom:4px">Request for Quotation</h2><p style="font-size:13px;color:var(--w40);margin-bottom:20px">Tell us what you\'re looking for and we\'ll connect you with verified Korean manufacturers.</p>'+
  '<form id="rfqForm" onsubmit="event.preventDefault();submitRFQ()">'+
  '<div class="card"><div class="card-h">Your Information</div><div class="card-b">'+
  '<div class="grid-2">'+
  '<div class="form-group"><label class="form-label">Company Name *</label><input class="form-input" name="company" required placeholder="Your company name"></div>'+
  '<div class="form-group"><label class="form-label">Contact Person *</label><input class="form-input" name="contact" required placeholder="Full name"></div></div>'+
  '<div class="grid-2">'+
  '<div class="form-group"><label class="form-label">Email *</label><input class="form-input" name="email" type="email" required placeholder="your@email.com"></div>'+
  '<div class="form-group"><label class="form-label">Country *</label><select class="form-select" name="country" required><option value="">Select country</option><option value="US">United States</option><option value="JP">Japan</option><option value="DE">Germany</option><option value="CN">China</option><option value="SG">Singapore</option><option value="VN">Vietnam</option><option value="AE">UAE</option><option value="AU">Australia</option><option value="TH">Thailand</option><option value="ID">Indonesia</option><option value="GB">United Kingdom</option><option value="FR">France</option><option value="CA">Canada</option><option value="other">Other</option></select></div></div>'+
  '</div></div>'+
  '<div class="card"><div class="card-h">Product Requirements</div><div class="card-b">'+
  '<div class="form-group"><label class="form-label">Product Category *</label><select class="form-select" name="category" required><option value="">Select category</option><option value="skincare">Skincare</option><option value="makeup">Color Cosmetics</option><option value="haircare">Hair Care</option><option value="bodycare">Body Care</option><option value="supplement">Health Supplements</option><option value="food">Food & Beverage</option><option value="device">Beauty Devices</option><option value="other">Other</option></select></div>'+
  '<div class="form-group"><label class="form-label">Product Description *</label><textarea class="form-textarea" name="description" required placeholder="Describe the products you\'re looking for (type, ingredients, target price range, etc.)"></textarea></div>'+
  '<div class="grid-2">'+
  '<div class="form-group"><label class="form-label">Target Quantity (MOQ)</label><input class="form-input" name="moq" type="number" placeholder="e.g., 1000"></div>'+
  '<div class="form-group"><label class="form-label">Target Unit Price (USD)</label><input class="form-input" name="price" placeholder="e.g., $3-5"></div></div>'+
  '<div class="form-group"><label class="form-label">Additional Notes</label><textarea class="form-textarea" name="notes" placeholder="Certifications needed, packaging requirements, etc." rows="3"></textarea></div>'+
  '</div></div>'+
  '<button class="btn btn-pri btn-block" type="submit" style="padding:14px;font-size:15px;margin-bottom:20px">Submit RFQ</button>'+
  '</form></div>';
}

function loadProducts(){
  sb.from('products').select('*').eq('is_public',true).eq('status','active').order('created_at',{ascending:false}).then(function(r){
    S.products=r.data||[];
    /* fallback: if no public products, show all */
    if(!S.products.length){
      sb.from('products').select('*').eq('status','active').order('created_at',{ascending:false}).limit(20).then(function(r2){
        S.products=r2.data||[];render();
      });
    }else{render();}
  });
}

function inquireProduct(productId){
  S.section='rfq';render();
  var p=S.products.find(function(x){return x.id===productId;});
  if(p){
    setTimeout(function(){
      var desc=document.querySelector('[name=description]');
      if(desc)desc.value='Interested in: '+(p.name_en||p.name_ko)+'\nCategory: '+(p.category||'')+'\nHS Code: '+(p.hs_code||'');
    },100);
  }
}

function submitRFQ(){
  var f=document.getElementById('rfqForm');
  var fd=new FormData(f);
  var data={};fd.forEach(function(v,k){data[k]=v;});
  if(!data.company||!data.email||!data.country||!data.category||!data.description){toast('Please fill all required fields','err');return;}

  /* Save to contact_requests via buyers table */
  var buyerData={
    source:'platform',company_name:data.company,contact_name:data.contact,
    email:data.email,country:data.country,categories:[data.category],
    moq_range:data.moq?data.moq+' units':'',target_price_range:data.price||'',
    notes:'[RFQ]\n'+data.description+(data.notes?'\n\nNotes: '+data.notes:''),
    tags:['rfq','buyer-portal']
  };
  sb.from('buyers').insert(buyerData).then(function(r){
    if(r.error){toast('Submission failed. Please try again.','err');return;}
    /* Also create contact_request */
    sb.from('contact_requests').insert({
      buyer_id:r.data&&r.data[0]?r.data[0].id:null,
      product_query:data.category+': '+data.description,
      destination_country:data.country,
      target_moq:parseInt(data.moq)||null,
      target_price:data.price||null,
      message:data.description+(data.notes?'\n'+data.notes:'')
    }).then(function(){});
    toast('RFQ submitted successfully! We\'ll contact you within 24 hours.','ok');
    S.section='thankyou';
    document.getElementById('app').innerHTML='<div style="text-align:center;padding:60px 20px"><div style="font-size:48px;margin-bottom:16px">‚úÖ</div><h2 style="font-size:24px;font-weight:800;margin-bottom:8px">Thank You!</h2><p style="font-size:14px;color:var(--w60);max-width:400px;margin:0 auto 20px">Your RFQ has been submitted. Our team will review your requirements and connect you with suitable Korean manufacturers within 24 hours.</p><div style="display:flex;gap:10px;justify-content:center"><button class="btn btn-pri" onclick="showSection(\'home\')">Back to Home</button><button class="btn btn-ghost" onclick="showSection(\'products\')">Browse Products</button></div></div>';
  });
}

/* Init */
loadProducts();
render();
</script>
</body>
</html>
